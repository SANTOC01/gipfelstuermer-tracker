<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GipfelstÃ¼rmer Event 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.3.5"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; padding: 20px; }
        input, button { margin: 10px; padding: 10px; font-size: 16px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid black; padding: 8px; background: white; }
        canvas { margin-top: 20px; }
        .progress-bar { width: 100%; background: #ddd; border-radius: 20px; }
        .progress { height: 30px; width: 0%; background: #4caf50; text-align: center; color: white; border-radius: 20px; }
        .announcement { font-size: 18px; font-weight: bold; color: #d9534f; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸƒ GipfelstÃ¼rmer Event 2025 ğŸŒ„ï¸</h1>
    <p>Gemeinsam sammeln wir 75.000 HÃ¶henmeter bis zum 27.07.2025!</p>
    
    <input type="text" id="name" placeholder="Dein Name">
    <input type="number" id="hohenmeter" placeholder="HÃ¶henmeter">
    <button onclick="submitData()">Absenden</button>
    
    <h2>ğŸ“ Letzte EintrÃ¤ge</h2>
    <table id="dataTable">
        <tr><th>Name</th><th>HÃ¶henmeter</th><th>Datum</th><th>LÃ¶schen</th></tr>
    </table>
    
    <h2>ğŸ“Š Fortschritt</h2>
    <div class="progress-bar">
        <div class="progress" id="progressBar">0%</div>
    </div>
    <canvas id="myChart"></canvas>
    
    <h2>ğŸ† Erreichte Ziele</h2>
    <p class="announcement" id="lastGoal">Noch kein Ziel erreicht...</p>
    
    <h2>ğŸ… Belohnungen</h2>
    <ul>
        <li id="goal1">ğŸ­ <b>10.000 HM</b> â†’ Trainer im KostÃ¼m</li>
        <li id="goal2">ğŸ• <b>25.000 HM</b> â†’ Pizza nach dem Lauf</li>
        <li id="goal3">ğŸ¥¤ <b>50.000 HM</b> â†’ Geheimsnack & GetrÃ¤nke</li>
        <li id="goal4">ğŸ° <b>75.000 HM</b> â†’ Erdbeertorte & Urkunden!</li>
    </ul>
    
    <script>
        const sheetURL = "https://script.google.com/macros/s/AKfycbxrWgd0RYqOA9lb6sgWb_Zo09XCbbwQBWs51ksKF6_xduKWJctC5OhdGxoPC9Icxcv1/exec";
        const goals = [10000, 25000, 50000, 75000];
        const goalNames = [
            "Trainer im KostÃ¼m", 
            "Pizza nach dem Lauf", 
            "Geheimsnack & GetrÃ¤nke", 
            "Erdbeertorte & Urkunden!"
        ];

        async function submitData() {
            const name = document.getElementById("name").value;
            const hohenmeter = document.getElementById("hohenmeter").value;
            
            if (!name || !hohenmeter) {
                alert("Bitte beide Felder ausfÃ¼llen!");
                return;
            }

            await fetch(sheetURL, {
                method: "POST",
                body: JSON.stringify({ name, hohenmeter }),
                headers: { "Content-Type": "application/json" }
            });
            
            alert("Eingetragen! Danke fÃ¼rs Mitmachen! ğŸ‰");
            location.reload();
        }
        
        async function loadData() {
            const response = await fetch(sheetURL);
            const data = await response.json();
            const table = document.getElementById("dataTable");
            
            table.innerHTML = "<tr><th>Name</th><th>HÃ¶henmeter</th><th>Datum</th><th>LÃ¶schen</th></tr>";
            let total = 0;
            
            data.slice(1).forEach(row => {
                table.innerHTML += `<tr>
                    <td>${row[0]}</td>
                    <td>${row[1]}</td>
                    <td>${new Date(row[2]).toLocaleDateString()}</td>
                </tr>`;
                total += parseInt(row[1]);
            });
            
            updateProgress(total);
            drawChart(total);
            checkGoals(total);
        }
        
        function updateProgress(total) {
            const percentage = (total / 75000) * 100;
            document.getElementById("progressBar").style.width = percentage + "%";
            document.getElementById("progressBar").textContent = Math.round(percentage) + "%";
        }
        
        function checkGoals(total) {
            let lastReached = "Noch kein Ziel erreicht...";
            goals.forEach((goal, index) => {
                if (total >= goal) {
                    document.getElementById(`goal${index+1}`).style.color = "green";
                    lastReached = `Letztes Ziel erreicht: ${goalNames[index]}! ğŸ‰`;
                    confetti();
                }
            });
            document.getElementById("lastGoal").innerText = lastReached;
        }

        function drawChart(total) {
            const ctx = document.getElementById("myChart").getContext("2d");
            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: ["Gesamt-HÃ¶henmeter"],
                    datasets: [{ label: "Fortschritt", data: [total], backgroundColor: "#4caf50" }]
                }
            });
        }
        
        loadData();
    </script>
</body>
</html>
